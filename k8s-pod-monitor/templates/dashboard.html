<!DOCTYPE html><html lang="ko"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Kubernetes Pod Monitor</title><link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"><script src="https://cdn.plot.ly/plotly-2.32.0.min.js"></script><style>body{background-color:#f8f9fa}.card{box-shadow:0 2px 4px #0000001a}.stat-card .card-title{font-size:1.1rem;color:#6c757d}.stat-card .card-text{font-size:2.5rem;font-weight:700}.table-responsive{max-height:400px}.nav-tabs .nav-link{color:#495057}.nav-tabs .nav-link.active{color:#0d6efd;font-weight:700}#loading-spinner{position:fixed;top:50%;left:50%;z-index:1050;transform:translate(-50%,-50%)}.table th:first-child,.table td:first-child{width:15%}.badge.bg-danger{background-color:#dc3545!important}.badge.bg-warning{background-color:#ffc107!important}.badge.bg-info{background-color:#0dcaf0!important}.badge.bg-success{background-color:#198754!important}</style></head><body><div id="loading-spinner" class="spinner-border text-primary" role="status" style="display:none"><span class="visually-hidden">Loading...</span></div><div class="container-fluid mt-4"><div class="d-flex justify-content-between align-items-center mb-4"><h1 class="h3">üìä Kubernetes Pod Monitor (OIDC Aware)</h1><div><button id="force-refresh-btn" class="btn btn-primary">üîÑ Force Refresh</button></div></div><div class="row mb-3"><div class="col"><small class="text-muted">Last Updated: <span id="last-updated">N/A</span> | Background Status: <span id="background-status">N/A</span></small></div></div><div class="row mb-4"><div class="col-lg-3 col-md-6 mb-3"><div class="card text-center h-100"><div class="card-body"><h5 class="card-title">üö® Total Abnormal Pods</h5><p id="stat-total" class="card-text text-danger">0</p></div></div></div><div class="col-lg-3 col-md-6 mb-3"><div class="card text-center h-100"><div class="card-body"><h5 class="card-title">‚ú® New Issues (Today)</h5><p id="stat-new" class="card-text text-warning">0</p></div></div></div><div class="col-lg-3 col-md-6 mb-3"><div class="card text-center h-100"><div class="card-body"><h5 class="card-title">‚è≥ Ongoing Issues</h5><p id="stat-ongoing" class="card-text text-info">0</p></div></div></div><div class="col-lg-3 col-md-6 mb-3"><div class="card text-center h-100"><div class="card-body"><h5 class="card-title">‚úÖ Resolved Issues</h5><p id="stat-resolved" class="card-text text-success">0</p></div></div></div></div><div class="row mb-4"><div class="col-lg-6 mb-3"><div class="card h-100"><div class="card-header">Status Distribution</div><div class="card-body"><div id="chart-status-distribution"></div></div></div></div><div class="col-lg-6 mb-3"><div class="card h-100"><div class="card-header">Abnormal Pods by Cluster</div><div class="card-body"><div id="chart-cluster-distribution"></div></div></div></div></div><div class="card"><div class="card-header"><ul class="nav nav-tabs card-header-tabs"><li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#tab-new">New <span id="badge-new" class="badge bg-warning"></span></a></li><li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#tab-ongoing">Ongoing <span id="badge-ongoing" class="badge bg-info"></span></a></li><li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#tab-resolved">Resolved <span id="badge-resolved" class="badge bg-success"></span></a></li></ul></div><div class="card-body"><div class="tab-content"><div class="tab-pane fade show active" id="tab-new"><div class="table-responsive"><table class="table table-striped table-hover"><thead><tr><th>Cluster</th><th>Namespace</th><th>Pod</th><th>Status</th><th>Node</th><th>Reasons</th><th>Timestamp</th></tr></thead><tbody id="table-body-new"></tbody></table></div></div><div class="tab-pane fade" id="tab-ongoing"><div class="table-responsive"><table class="table table-striped table-hover"><thead><tr><th>Cluster</th><th>Namespace</th><th>Pod</th><th>Status</th><th>Node</th><th>Reasons</th><th>Timestamp</th></tr></thead><tbody id="table-body-ongoing"></tbody></table></div></div><div class="tab-pane fade" id="tab-resolved"><div class="table-responsive"><table class="table table-striped table-hover"><thead><tr><th>Cluster</th><th>Namespace</th><th>Pod</th><th>Status</th><th>Node</th><th>Reasons</th><th>Timestamp</th></tr></thead><tbody id="table-body-resolved"></tbody></table></div></div></div></div></div></div><script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script><script>document.addEventListener("DOMContentLoaded",function(){const t="/api/data",e="/api/run-check",n=document.getElementById("loading-spinner");function a(){n.style.display="block"}function o(){n.style.display="none"}function i(t){const e=t.status==="Running"?"bg-warning":"bg-danger";return`<tr><td><b>${t.cluster||"N/A"}</b></td><td>${t.namespace||"N/A"}</td><td>${t.pod||"N/A"}</td><td><span class="badge ${e}">${t.status||"N/A"}</span></td><td>${t.node||"N/A"}</td><td>${t.reasons||"N/A"}</td><td>${t.timestamp?new Date(t.timestamp).toLocaleString():"N/A"}</td></tr>`}async function d(){try{const e=await fetch(t);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);(t=>{document.getElementById("stat-total").textContent=t.stats.total,document.getElementById("stat-new").textContent=t.stats.new,document.getElementById("stat-ongoing").textContent=t.stats.ongoing,document.getElementById("stat-resolved").textContent=t.stats.resolved,document.getElementById("badge-new").textContent=t.stats.new,document.getElementById("badge-ongoing").textContent=t.stats.ongoing,document.getElementById("badge-resolved").textContent=t.stats.resolved,document.getElementById("table-body-new").innerHTML=t.lists.new.map(i).join(""),document.getElementById("table-body-ongoing").innerHTML=t.lists.ongoing.map(i).join(""),document.getElementById("table-body-resolved").innerHTML=t.lists.resolved.map(i).join("");const e={margin:{l:40,r:20,t:40,b:20},height:300};Plotly.newPlot("chart-status-distribution",[{labels:t.charts.status_distribution.labels,values:t.charts.status_distribution.values,type:"pie",hole:.4}],e,{responsive:!0,displaylogo:!1}),Plotly.newPlot("chart-cluster-distribution",[{x:t.charts.cluster_distribution.labels,y:t.charts.cluster_distribution.values,type:"bar",marker:{color:"#0d6efd"}}],e,{responsive:!0,displaylogo:!1}),document.getElementById("last-updated").textContent=new Date(t.last_updated).toLocaleString(),t.background_status&&(document.getElementById("background-status").textContent=`${t.background_status.last_run} (${t.background_status.last_result}`)})(await e.json())}catch(t){console.error("Failed to fetch data:",t),alert("Failed to load dashboard data. Please check server logs.")}}a(),d().finally(o),setInterval(d,6e4),document.getElementById("force-refresh-btn").addEventListener("click",async function(){a(),document.getElementById("force-refresh-btn").disabled=!0;try{const t=await fetch(e,{method:"POST"}),n=await t.json();if(!t.ok)throw new Error(n.message||"Failed to start refresh.");alert(n.message),setTimeout(()=>d().finally(()=>{o(),document.getElementById("force-refresh-btn").disabled=!1}),3e3)}catch(t){console.error("Failed to force refresh:",t),alert(`Error: ${t.message}`),o(),document.getElementById("force-refresh-btn").disabled=!1}})});</script></body></html>
